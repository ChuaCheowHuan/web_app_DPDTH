<h1 id="orms-apis">ORMs, APIs</h1>

<h2 id="object-oriented-programming">Object-Oriented Programming</h2>

<ul>
  <li>Python, along with many other programming langauges, use Object-Oriented Programming (OOP). An ‘object’ is a discrete item. OOP allows for the creation of classes, which are the generic forms of objects. For example, a ‘flight’ class is defines all the components which describe a flight, as well as actions that a flight should be able to take, such as adding a passenger. Similarly, a passenger class would represent the generic idea of passenger, defined by a name and associated with a flight, perhaps.</li>
  <li>Here’s a simple example of a Python class.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">Flight</span><span class="p">:</span>

      <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">origin</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>
</code></pre></div>    </div>
    <ul>
      <li><code class="highlighter-rouge">__init__</code> is a ‘method’, which is a function performed on individual objects. <code class="highlighter-rouge">__init__</code> in particular is a special, built-in method that describes what should happen when a flight object is created.</li>
      <li>Generally, methods take <code class="highlighter-rouge">self</code> as their first argument. <code class="highlighter-rouge">self</code> refers to the object being worked with. The other three arguments are simply the information that should be stored about a particular flight. That information is stored as ‘properties’ inside the object, using dot notation.</li>
    </ul>
  </li>
  <li>Here’s how the <code class="highlighter-rouge">Flight</code> class might be used:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># Create flight.</span>
  <span class="n">f</span> <span class="o">=</span> <span class="n">Flight</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">"New York"</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s">"Paris"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">540</span><span class="p">)</span>

  <span class="c"># Change the value of a propety.</span>
  <span class="n">f</span><span class="o">.</span><span class="n">duration</span> <span class="o">+=</span> <span class="mi">10</span>

  <span class="c"># Print details about flight.</span>
  <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li>Note that only flight information is passed in to <code class="highlighter-rouge">Flight()</code>; the <code class="highlighter-rouge">self</code> argument to the <code class="highlighter-rouge">__init__</code> method is automatically specified.</li>
      <li><code class="highlighter-rouge">f</code> is a variable of type <code class="highlighter-rouge">Flight</code>, just like a variable might be of type <code class="highlighter-rouge">str</code> or <code class="highlighter-rouge">int</code>.</li>
    </ul>
  </li>
  <li>Additional methods can be added to the <code class="highlighter-rouge">Flight class</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">Flight</span><span class="p">:</span>

      <span class="c"># assume same __init__ method</span>

      <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Flight origin: {self.origin}"</span><span class="p">)</span>
          <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Flight destination: {self.destination}"</span><span class="p">)</span>
          <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Flight duration: {self.duration}"</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
      <span class="n">f1</span> <span class="o">=</span> <span class="n">Flight</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">"New York"</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s">"Paris"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">540</span><span class="p">)</span>
      <span class="n">f1</span><span class="o">.</span><span class="n">print_info</span><span class="p">()</span>
</code></pre></div>    </div>
    <ul>
      <li>Now, this functionality of printing out flight info can be used with any flight object that might be created. Each time, <code class="highlighter-rouge">self</code> refers to the object that the method is being called on. In this example, that’s <code class="highlighter-rouge">f1</code>.</li>
    </ul>
  </li>
  <li>Methods can also take additional arguments and modify properties.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">delay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">+=</span> <span class="n">amount</span>
</code></pre></div>    </div>
    <ul>
      <li>Note that writing methods like <code class="highlighter-rouge">delay</code> and <code class="highlighter-rouge">print_info</code>, as well just the idea of <code class="highlighter-rouge">Flight</code> class in general, allow for abstraction. The <code class="highlighter-rouge">Flight</code> class and all of its methods can be used in a logical and easily understood way without needing to know or even understand how <code class="highlighter-rouge">Flight</code> may be implemented.</li>
    </ul>
  </li>
  <li>Given a simple <code class="highlighter-rouge">Passenger</code> class…
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">Passenger</span><span class="p">:</span>

      <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div>    </div>
  </li>
  <li>A more complex <code class="highlighter-rouge">Flight</code> class can be implemented.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">class</span> <span class="nc">Flight</span><span class="p">:</span>

      <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>

      <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>

          <span class="c"># Keep track of id number.</span>
          <span class="bp">self</span><span class="o">.</span><span class="nb">id</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">counter</span>
          <span class="n">Flight</span><span class="o">.</span><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

          <span class="c"># Keep track of passengers.</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">passengers</span> <span class="o">=</span> <span class="p">[]</span>

          <span class="c"># Details about flight.</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="n">origin</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">destination</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">duration</span>

      <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
          <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Flight origin: {self.origin}"</span><span class="p">)</span>
          <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Flight destination: {self.destination}"</span><span class="p">)</span>
          <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Flight duration: {self.duration}"</span><span class="p">)</span>

          <span class="k">print</span><span class="p">()</span>
          <span class="k">print</span><span class="p">(</span><span class="s">"Passengers:"</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">passenger</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">passengers</span><span class="p">:</span>
              <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"{passenger.name}"</span><span class="p">)</span>

      <span class="k">def</span> <span class="nf">add_passenger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">passengers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
          <span class="n">p</span><span class="o">.</span><span class="n">flight_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="nb">id</span>
</code></pre></div>    </div>
    <ul>
      <li>Note that <code class="highlighter-rouge">counter</code> is defined outside of the <code class="highlighter-rouge">__init__</code> function and is not specific to individual flights (it’s not defined as <code class="highlighter-rouge">self.counter</code>. This means that all flight objects can see this same counter variable, which allows for the implementation the <code class="highlighter-rouge">id</code> property shown here. Similar to the SQL database which had an auto-incrementing <code class="highlighter-rouge">id</code> column, the <code class="highlighter-rouge">id</code> property of flights will automatically incrememt as new flight objects are created.</li>
      <li>The <code class="highlighter-rouge">passengers</code> property of <code class="highlighter-rouge">Flights</code> is going to be a list of <code class="highlighter-rouge">Passenger</code> objects.</li>
      <li>In <code class="highlighter-rouge">add_passenger</code>, <code class="highlighter-rouge">p.flight_id</code> is created, because <code class="highlighter-rouge">flight_id</code> is not defined in the <code class="highlighter-rouge">Passenger</code> class’s <code class="highlighter-rouge">__init__</code>.</li>
    </ul>
  </li>
  <li>Here’s how the more advanced <code class="highlighter-rouge">Flight</code> class could be used:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c"># Create flight.</span>
  <span class="n">f1</span> <span class="o">=</span> <span class="n">Flight</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">"New York"</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s">"Paris"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">540</span><span class="p">)</span>

  <span class="c"># Create passengers.</span>
  <span class="n">alice</span> <span class="o">=</span> <span class="n">Passenger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Alice"</span><span class="p">)</span>
  <span class="n">bob</span> <span class="o">=</span> <span class="n">Passenger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Bob"</span><span class="p">)</span>

  <span class="c"># Add passengers.</span>
  <span class="n">f1</span><span class="o">.</span><span class="n">add_passenger</span><span class="p">(</span><span class="n">alice</span><span class="p">)</span>
  <span class="n">f1</span><span class="o">.</span><span class="n">add_passenger</span><span class="p">(</span><span class="n">bob</span><span class="p">)</span>

  <span class="n">f1</span><span class="o">.</span><span class="n">print_info</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="object-relational-mapping">Object Relational Mapping</h3>

<ul>
  <li>Object-Relational Mapping, or ORM, allows for the combination of the OOP world of Python and the relational database world of SQL. With ORM, Python classes, methods, and objects become the tools for interacting with SQL databases. To do this, the Flask-SQLAlchemy package will be used.</li>
  <li>The basic setup, inside <code class="highlighter-rouge">models.py</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>

  <span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">()</span>

  <span class="k">class</span> <span class="nc">Flight</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
      <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">"flights"</span>
      <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">origin</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
      <span class="n">destination</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
      <span class="n">duration</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


  <span class="k">class</span> <span class="nc">Passenger</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
      <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">"passengers"</span>
      <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
      <span class="n">flight_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">"flights.id"</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li>For any table inside of the database, there is one class defined inside <code class="highlighter-rouge">models.py</code>.</li>
      <li>Adding <code class="highlighter-rouge">db.Model</code> in parentheses after class names indicates that these classes ‘inherit’ from <code class="highlighter-rouge">db.Model</code>. The details of inheritance are unimportant right now; simply, this allows for the class to have some built-in relationship with SQLAlchemy to interact with the database.</li>
      <li><code class="highlighter-rouge">__tablename__</code> naturally corresponds with the table name inside the database.</li>
      <li>Every property is defined as a <code class="highlighter-rouge">db.Column</code>, which will become columns in the table. The arguments to <code class="highlighter-rouge">db.Column</code> are naturally similar to those use for table creation in SQL.</li>
      <li>Note that <code class="highlighter-rouge">flights.id</code> is marked as a foreign key using the <code class="highlighter-rouge">__tablename__</code> <code class="highlighter-rouge">flights</code>, not the class name <code class="highlighter-rouge">Flight</code>.</li>
    </ul>
  </li>
  <li>Now that there’s a defined structure for how the tables should look, they can be created inside a Flask application.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">os</span>

  <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>

  <span class="c"># Import table definitions.</span>
  <span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="o">*</span>

  <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

  <span class="c"># Tell Flask what SQLAlchemy databas to use.</span>
  <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">"SQLALCHEMY_DATABASE_URI"</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"DATABASE_URL"</span><span class="p">)</span>
  <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">"SQLALCHEMY_TRACK_MODIFICATIONS"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>

  <span class="c"># Link the Flask app with the database (no Flask app is actually being run yet).</span>
  <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
      <span class="c"># Create tables based on each table definition in `models`</span>
      <span class="n">db</span><span class="o">.</span><span class="n">create_all</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
      <span class="c"># Allows for command line interaction with Flask application</span>
      <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">app_context</span><span class="p">():</span>
          <span class="n">main</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="python-versions-of-sql-queries">Python Versions of SQL Queries</h3>

<ul>
  <li><code class="highlighter-rouge">db.create_all()</code> is the Python-Flask-SQLAlchemy’s version of the <code class="highlighter-rouge">CREATE</code> SQL command.</li>
  <li>SQL’s <code class="highlighter-rouge">INSERT</code>…
    <pre><code class="language-SQL">  INSERT INTO flights
      (origin, destination, duration)
      VALUES ('New York', 'Paris', 540)
</code></pre>
  </li>
  <li>…and Python’s <code class="highlighter-rouge">INSERT</code>.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">flight</span> <span class="o">=</span> <span class="n">Flight</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">"New York"</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="s">"Paris"</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="mi">540</span><span class="p">)</span>
  <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">flight</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li>SQlAlchemy automatically takes care of SQL transactions with <code class="highlighter-rouge">db.session</code>.</li>
    </ul>
  </li>
  <li>SQL’s <code class="highlighter-rouge">SELECT</code>…
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">'Paris'</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">'Paris'</span> <span class="k">LIMIT</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="o">=</span> <span class="s1">'Paris'</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">origin</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">ORDER</span> <span class="k">by</span> <span class="n">origin</span> <span class="k">DESC</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="o">!=</span> <span class="s1">'Paris'</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="k">LIKE</span> <span class="s1">'%a%'</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'Tokyo'</span><span class="p">,</span> <span class="s1">'Paris'</span><span class="p">);</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROm</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="o">=</span> <span class="nv">"Paris"</span>
      <span class="k">AND</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROm</span> <span class="n">flights</span>
      <span class="k">WHERE</span> <span class="n">origin</span> <span class="o">=</span> <span class="nv">"Paris"</span>
      <span class="k">AND</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">;</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">JOIN</span> <span class="n">passengers</span>
      <span class="k">ON</span> <span class="n">flights</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">passengers</span><span class="p">.</span><span class="n">flight_id</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>…and Python’s <code class="highlighter-rouge">SELECT</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">fliter_by</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">"Paris"</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">"Paris"</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="s">"Paris"</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Flight</span><span class="o">.</span><span class="n">origin</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Flights</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">desc</span><span class="p">())</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Flight</span><span class="o">.</span><span class="n">origin</span> <span class="o">!=</span> <span class="s">"Paris"</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Fligiht</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="s">"</span><span class="si">%</span><span class="s">a</span><span class="si">%</span><span class="s">"</span><span class="p">))</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Flight</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">in_</span><span class="p">([</span><span class="s">"Tokyo"</span><span class="p">,</span> <span class="s">"Paris"</span><span class="p">]))</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">and_</span><span class="p">(</span><span class="n">Flight</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s">"Paris"</span><span class="p">,</span> <span class="n">Flight</span><span class="o">.</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">))</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">or_</span><span class="p">(</span><span class="n">Flight</span><span class="o">.</span><span class="n">origin</span> <span class="o">==</span> <span class="s">"Paris"</span><span class="p">,</span> <span class="n">Flight</span><span class="o">.</span><span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">))</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
  <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Flight</span><span class="p">,</span> <span class="n">Passenger</span><span class="p">)</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Flight</span><span class="o">.</span><span class="nb">id</span> <span class="o">==</span> <span class="n">Passenger</span><span class="o">.</span><span class="n">flight_id</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>SQL’s <code class="highlighter-rouge">UPDATE</code>…
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">UPDATE</span> <span class="n">flights</span> <span class="k">SET</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">280</span>
      <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>…and Python’s <code class="highlighter-rouge">UPDATE</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">flight</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
  <span class="n">flight</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="mi">280</span>
</code></pre></div>    </div>
  </li>
  <li>SQL’s <code class="highlighter-rouge">DELETE</code>…
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>…and Python’s <code class="highlighter-rouge">DELETE</code>:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">flight</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>
  <span class="n">db</span><span class="o">.</span><span class="n">ksession</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">flight</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Some other miscellaneous SQL commands…
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">COMMIT</span><span class="p">;</span>

</code></pre></div>    </div>
  </li>
  <li>…and their Python parallels.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>Before, when importing data from a CSV file, SQL code had to be written directly into the Python file. Now, SQLAlchemy can take care of that behind the scenes.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">csv</span>

  <span class="c"># Same setup code as before.</span>

  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
      <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">"flights.csv"</span><span class="p">)</span>
      <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
          <span class="n">flight</span> <span class="o">=</span> <span class="n">Flight</span><span class="p">(</span><span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="o">=</span><span class="n">destination</span><span class="p">,</span> <span class="n">duration</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
          <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">flight</span><span class="p">)</span>
          <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"Added flight from {origin} to {destination} lasting {duration} minutes."</span><span class="p">)</span>
      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="orm-integrated-into-a-web-application">ORM Integrated into a Web Application</h3>

<ul>
  <li>Putting it all together, here’s the same web application from the end of Lecture 3, using SQLAlchemy. Note that there are no raw SQL commands. The power of ORM, classes, and objects is used to insert and select from the database.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span>
  <span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="o">*</span>

  <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
  <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">"SQLALCHEMY_DATABASE_URI"</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"DATABASE_URL"</span><span class="p">)</span>
  <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">"SQLALCHEMY_TRACK_MODIFICATIONS"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
  <span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


  <span class="nd">@app.route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
      <span class="n">flights</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"index.html"</span><span class="p">,</span> <span class="n">flights</span><span class="o">=</span><span class="n">flights</span><span class="p">)</span>


  <span class="nd">@app.route</span><span class="p">(</span><span class="s">"/book"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"POST"</span><span class="p">])</span>
  <span class="k">def</span> <span class="nf">book</span><span class="p">():</span>
      <span class="s">"""Book a flight."""</span>

      <span class="c"># Get form information.</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">flight_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"flight_id"</span><span class="p">))</span>
      <span class="k">except</span> <span class="nb">ValueError</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"Invalid flight number."</span><span class="p">)</span>

      <span class="c"># Make sure the flight exists.</span>
      <span class="n">flight</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flight_id</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">flight</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"No such flight with that id."</span><span class="p">)</span>

      <span class="c"># Add passenger.</span>
      <span class="n">passenger</span> <span class="o">=</span> <span class="n">Passenger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">flight_id</span><span class="o">=</span><span class="n">flight_id</span><span class="p">)</span>
      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">passenger</span><span class="p">)</span>
      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"success.html"</span><span class="p">)</span>


  <span class="nd">@app.route</span><span class="p">(</span><span class="s">"/flights"</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">flights</span><span class="p">():</span>
      <span class="s">"""List all flights."""</span>
      <span class="n">flights</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"flights.html"</span><span class="p">,</span> <span class="n">flights</span><span class="o">=</span><span class="n">flights</span><span class="p">)</span>


  <span class="nd">@app.route</span><span class="p">(</span><span class="s">"/flights/&lt;int:flight_id&gt;"</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">flight</span><span class="p">(</span><span class="n">flight_id</span><span class="p">):</span>
      <span class="s">"""List details about a single flight."""</span>

      <span class="c"># Make sure flight exists.</span>
      <span class="n">flight</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flight_id</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">flight</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"error.html"</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">"No such flight."</span><span class="p">)</span>

      <span class="c"># Get all passengers.</span>
      <span class="n">passengers</span> <span class="o">=</span> <span class="n">Passenger</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">flight_id</span><span class="o">=</span><span class="n">flight_id</span><span class="p">)</span><span class="o">.</span><span class="nb">all</span><span class="p">()</span>
      <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">"flight.html"</span><span class="p">,</span> <span class="n">flight</span><span class="o">=</span><span class="n">flight</span><span class="p">,</span> <span class="n">passengers</span><span class="o">=</span><span class="n">passengers</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>Because classes are flexible, whatever additional functionality the app may need can be built into classes. Adding passengers, for example, can be defined as a method in the <code class="highlighter-rouge">Flight</code> class (in <code class="highlighter-rouge">models.py</code>).
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">add_passenger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
      <span class="n">p</span> <span class="o">=</span> <span class="n">Passenger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">flight_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>Now, after verifying that the flight exists, the all that is needed in the <code class="highlighter-rouge">book</code> function of <code class="highlighter-rouge">application.py</code> is the following:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">flight</span><span class="o">.</span><span class="n">add_passenger</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li>Now, there is on direct creation of passengers in the application. It’s all handled by the <code class="highlighter-rouge">Flight</code> class.</li>
    </ul>
  </li>
</ul>

<h3 id="relationships">Relationships</h3>

<ul>
  <li>One more powerful feature of ORMs is the idea of relationships. SQLAlchemy relationships are an easy way to take one table and relate it to another table, such that the each can refer to the other. A relationship is set up with a single line, which in this case would be added to the definition of the <code class="highlighter-rouge">Flight</code> class.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">passengers</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s">"Passenger"</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s">"flight"</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>    </div>
    <ul>
      <li><code class="highlighter-rouge">passengers</code> is not a column, but rather just a relationship. Given a flight object, the <code class="highlighter-rouge">passengers</code> property can be used to extract all the passenger info for that flight.</li>
      <li><code class="highlighter-rouge">backref</code> creates a relationship in the opposite direction, from <code class="highlighter-rouge">Flight</code> to <code class="highlighter-rouge">Passenger</code>.</li>
      <li><code class="highlighter-rouge">lazy</code> indicates that the information should be fetched only when it’s asked for.k</li>
    </ul>
  </li>
  <li>With these relationships set up, the code in <code class="highlighter-rouge">application.py</code>’s <code class="highlighter-rouge">flight</code> function to list get all passengers is extremely simplified.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">passengers</span> <span class="o">=</span> <span class="n">flight</span><span class="o">.</span><span class="n">passengers</span>
</code></pre></div>    </div>
  </li>
  <li>Once again, SQL’s <code class="highlighter-rouge">SELECT</code>…
    <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">passengers</span>
      <span class="k">WHERE</span> <span class="n">flight_id</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">flights</span> <span class="k">JOIN</span> <span class="n">passengers</span>
      <span class="k">ON</span> <span class="n">flights</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">passengers</span><span class="p">.</span><span class="n">flight_id</span>
      <span class="k">WHERE</span> <span class="n">passengers</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Alice'</span><span class="p">;</span>
</code></pre></div>    </div>
  </li>
  <li>…and Python’s relationship-powered <code class="highlighter-rouge">SELECT</code>.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">passengers</span>
  <span class="n">Passenger</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"Alice"</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">flight</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="apis">APIs</h2>

<ul>
  <li>An Application Programming Interface, or API, is a protocol for communication between different web applications or different components of the same application. These different components will want to share information with each other or perform actions on other spaces, and APIs allow for this interaction. It is useful, then, to have a standard language for how this communication will occur.</li>
</ul>

<h3 id="json">JSON</h3>

<ul>
  <li>One such language is Javascript Object Notation (JSON), which is a simple way of representing information in human- and computer-readable way so that it can be passed between parts of web application.</li>
  <li>Some example JSON:
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="s2">"origin"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Tokyo"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HND"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"destination"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Shanghai"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"PVG"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"duration"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">185</span><span class="p">,</span><span class="w">
      </span><span class="s2">"passengers"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Alice"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Bob"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
    <ul>
      <li>The curly braces enclose a JSON object.</li>
      <li>The contets of the JSON object are dvided into key-value pairs.</li>
      <li><code class="highlighter-rouge">origin</code> and <code class="highlighter-rouge">duration</code> are themselves JSON objects, which are nested in a hierarchical structure.</li>
      <li><code class="highlighter-rouge">passengers</code> shows how lists can be values.</li>
    </ul>
  </li>
  <li>Often times, the interaction between two APIs happens through the URL, which specifics which particular information that should be accessed. Some different levels might be:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  /flights/
  /flights/28/
  /flights/28/passengers/
  /flights/28/passengers/6/
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="http-methods">HTTP Methods</h3>

<ul>
  <li>Often times, there are different ways an API can be used. For example, one might get information about a passenger, register a new passenger, or change registration information for a flight.</li>
  <li>The HTTP request method will correspond to the type of action that should be performed. This is simply a convention that many APIs follow. Some HTTP methods include:
    <ul>
      <li><code class="highlighter-rouge">GET</code> : retrieve a resource</li>
      <li><code class="highlighter-rouge">POST</code> : create a new resource</li>
      <li><code class="highlighter-rouge">PUT</code> : replace a resource</li>
      <li><code class="highlighter-rouge">PATCH</code> : update a resource</li>
      <li><code class="highlighter-rouge">DELETE</code> : delete a resource</li>
    </ul>
  </li>
  <li>The Python Requests library allows for all these different HTTP methods to be used.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">import</span> <span class="nn">requests</span>

  <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
      <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"https://www.google.com/"</span><span class="p">)</span>
      <span class="k">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - `res` (response) is the HTTP response that comes from submitting, in this case, a `GET` request to a URL. All the following are also valid:
      - `requests.post(url)`
      - `requests.put(url)`
      - `requests.patch(url)`
      - `requests.delete(url)`
  - `res.text` is the HTML content of the page that is returned from the request.
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="an-example-api">An Example API</h3>

<ul>
  <li>To demonstrate the potential for these requests, <a href="https://fixer.io">Fixer</a>, a foreign exchange rate API, will be used in the following examples.</li>
  <li>Accessing the API at the URL http://data.fixer.io/api/latest?access_key=apikey&amp;base=EUR&amp;symbols=USD’ returns the following JSON:
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
      </span><span class="s2">"success"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1519296206</span><span class="p">,</span><span class="w">
      </span><span class="s2">"base"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EUR"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2018-07-11"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"rates"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="s2">"USD"</span><span class="p">:</span><span class="w"> </span><span class="mf">1.177482</span><span class="w">
      </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
  </li>
  <li>This API can be accessed in Python using the Requests library.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://data.fixer.io/api/latest?access_key=apikey&amp;base=EUR&amp;symbols=USD"</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
      <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">"ERROR: API request unsuccessful."</span><span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
  <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>    </div>
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - Checking the status code of the HTTP response ensures that the API returned what is expected by the application (a JSON formatted like the one above). As an aside, here are some common HTTP status codes. Generally, a leading 2 indicates a successful response, while a leading 4 indicates a failed request.
      - `200 OK`
      - `201 Created`
      - `400 Bad Request`
      - `403 Forbidden`
      - `404 Not Found`
      - `405 Method Not Allowed`
      - `422 Unprocessable Entity`
  - `res.json()` simply extracts the JSON response and puts into the Python variable `data`.
</code></pre></div>    </div>
  </li>
  <li>The previous returned the entire, raw JSON returned by the API. Since the format of the JSON is consistent and known, the most relevant information can be extracted and displayed.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">rate</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">"rates"</span><span class="p">][</span><span class="s">"USD"</span><span class="p">]</span>
  <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="s">"1 EUR is equal to {rate} USD"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>For a little more flexibility on what currencies are being converted, user input can be taken like so:
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">base</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"First Currency: "</span><span class="p">)</span>
  <span class="n">other</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"Second Currency: "</span><span class="p">)</span>
  <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">"http://data.fixer.io/api/latest"</span><span class="p">,</span>
                     <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s">"access_key"</span><span class="p">:</span> <span class="n">apikey</span><span class="p">,</span> <span class="s">"base"</span><span class="p">:</span> <span class="n">base</span><span class="p">,</span> <span class="s">"symbols"</span><span class="p">:</span> <span class="n">other</span><span class="p">})</span>
</code></pre></div>    </div>
    <ul>
      <li>What parameters should be passed into <code class="highlighter-rouge">params</code> (in this case, <code class="highlighter-rouge">"access_key"</code>, <code class="highlighter-rouge">"base"</code> and <code class="highlighter-rouge">"symbols"</code>) are defined in the API documentation.</li>
    </ul>
  </li>
</ul>

<h3 id="creating-an-api">Creating an API</h3>

<ul>
  <li>To implement an API for the recurring example of a airline flight manager, all that needs to be done is to define a route that returns a JSON object, just like Fixer does.
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">request</span>

  <span class="c"># ... other imports, set up code, and routes ...</span>

  <span class="nd">@app.route</span><span class="p">(</span><span class="s">"/api/flights/&lt;int:flight_id&gt;"</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">flight_api</span><span class="p">(</span><span class="n">flight_id</span><span class="p">):</span>
      <span class="s">"""Return details about a single flight."""</span>

      <span class="c"># Make sure flight exists.</span>
      <span class="n">flight</span> <span class="o">=</span> <span class="n">Flight</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flight_id</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">flight</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
          <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">"error"</span><span class="p">:</span> <span class="s">"Invalid flight_id"</span><span class="p">}),</span> <span class="mi">422</span>

      <span class="c"># Get all passengers.</span>
      <span class="n">passengers</span> <span class="o">=</span> <span class="n">flight</span><span class="o">.</span><span class="n">passengers</span>
      <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">passenger</span> <span class="ow">in</span> <span class="n">passengers</span><span class="p">:</span>
          <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">passenger</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
              <span class="s">"origin"</span><span class="p">:</span> <span class="n">flight</span><span class="o">.</span><span class="n">origin</span><span class="p">,</span>
              <span class="s">"destination"</span><span class="p">:</span> <span class="n">flight</span><span class="o">.</span><span class="n">destination</span><span class="p">,</span>
              <span class="s">"duration"</span><span class="p">:</span> <span class="n">flight</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
              <span class="s">"passengers"</span><span class="p">:</span> <span class="n">names</span>
          <span class="p">})</span>
</code></pre></div>    </div>
  </li>
  <li>The route URL is clearly marked as an API, and takes any flight ID as a parameter.</li>
  <li><code class="highlighter-rouge">jsonify</code> is a function provided by Flask that takes in a Python dictionary and converts it into JSON.</li>
  <li>If there is no flight found, an HTTP status code (422) is also returned with the JSON to indicate an error has occurred.</li>
  <li>Seen here again is the readability and simplicity of relationships when retrieving passenger information.</li>
  <li>If a valid flight ID was passed as a parameter, then a JSON object with all the flight info and a list of passengers is returned (because no status code is specified, it is set to 200 by default).</li>
</ul>

<h3 id="api-keys">API Keys</h3>

<ul>
  <li>With larger APIs, an often-implemented feature is rate limiting. It is undesirable to have users making a large number of requests that might overload the API or make it harder for other users to access it. To restrict access, users must first obtain an API key (a long string) which must be provided with any API request. Keys allow for the tracking of individual users only allowing, for example, 100 requests per hour per user.</li>
</ul>
